\documentclass[a4paper, 12pt, titlepage]{report}
\usepackage{minted}
\usepackage[dvipsnames]{xcolor}
\colorlet{LightBlue}{RoyalBlue!20}
\usepackage{graphicx}
\usepackage{fullpage}
\usepackage{float}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{fullpage}
\usepackage{float}
\usepackage{hyperref}
\usepackage{csquotes}
\usepackage[backend=biber]{biblatex}
\addbibresource{bibfile.bib}
\setlength{\tabcolsep}{18pt}
\renewcommand{\arraystretch}{1.5}
\renewcommand{\chaptername}{Section}
\hypersetup{
    colorlinks=true,
    linkcolor=RoyalBlue,
    filecolor=RoyalBlue,
    urlcolor=RoyalBlue,
    citecolor=RoyalBlue,
}
\begin{document}
\linespread{1.5}
\author{Affaan Muhammad - 33016763\\Joshua Esterhuizen - 30285976}
\title{ITRI625 - Computer Security II\\Metasploit Project Documentation}
\date{Due: October, 19th 2021}
\maketitle
\tableofcontents{}
\chapter{Installation and Setup}
\section{Project files}
The project files can be found on the following GitHub link:\\
\url{https://github.com/AM-ops/MetasploitProject/}
\\\\This was our main code repository. We both have been updating the code as we went along and added details and bug fixes to the project.\\\\
To copy the code to your own machine, follow the following steps:
\begin{enumerate}
\item Make sure Git is installed. If not it can be downloaded from here:\\
\url{https://git-scm.com/}
\item Create an empty directory where the code can be copied to
\item Run the following command:
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
]
{Shell}
git clone https://github.com/AM-ops/MetasploitProject.git
\end{minted}
\end{enumerate}
\section{Virtual Environments}
\label{sec:sec2}
There are multiple advantages of using virtual environments when testing for vulnerabilities and exploits in computer security. The primary reason being we create a layer of separation and abstraction between our host machine and our virtual environments. This 'sand-boxing' allows for analysis of threats in a contained environment.
\subsection{VirtualBox}
We made use of Oracle's VirtualBox software for the virtualisation. This can be downloaded from the following link: \url{https://www.virtualbox.org/wiki/Downloads}\\
Below is a screenshot of the site. We also chose the \texttt{Windows hosts} option to download. Other hosts can also be utilised such as Linux hosts, or OS X hosts.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.3]{pics/vbmain.PNG}
    \caption{Oracle's VirtualBox Download Page}
\end{figure}
Once the file has been downloaded, open it. Thereafter follow the default prompts of the installation. Below are some figures illustrating this.
\begin{multicols}{2}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vb1.PNG}
    \caption{Screen 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vb2.PNG}
    \caption{Screen 2}
\end{figure}
\end{multicols}
Click on \textbf{Next} for both above screens
\begin{multicols}{2}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vb3.PNG}
    \caption{Screen 3}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vb4.PNG}
    \caption{Screen 4}
\end{figure}
\end{multicols}
Click on \textbf{Next} for both of the above screens
\begin{multicols}{2}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vb5.PNG}
    \caption{Screen 5}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vb6.PNG}
    \caption{Screen 6}
\end{figure}
\end{multicols}
Click on \textbf{Next} and then \textbf{Finish}
\section{Kali Linux}
The next step is to acquire an Operating System for carrying out our Penetration Testing. For this purpose we utilised \texttt{Kali Linux}. The main site for this OS is: \url{https://www.kali.org/}\\\\
According to them they quote the following:
\begin{displayquote}
"\textbf{The Most Advanced Penetration Testing Distribution}\\
\textit{Kali Linux is an open-source, Debian-based Linux distribution geared towards various information security tasks, such as Penetration Testing, Security Research, Computer Forensics and Reverse Engineering.}"
\end{displayquote}
\pagebreak
The main site looks as follows
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/kali.PNG}
    \caption{Kali Linux's Homepage}
\end{figure}
Click on the \texttt{Download} button to see the different options available. Below the options are shown.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/kalidown.PNG}
    \caption{Kali Linux's different download options}
\end{figure}
The option we chose is the \texttt{Virtual Machines} one. Thereafter you are presented with the two options available.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/kalivb.PNG}
    \caption{The 2 options for Virtual Machines}
\end{figure}
Select the \texttt{VirtualBox} option and click on the direct download link.\\\\
After the download is completed it is time to set up Kali Linux inside VirtualBox. To achieve this open up the file and thereafter change the following settings.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vbkali1.PNG}
    \caption{The main screen once the file is opened}
\end{figure}
Click on \textbf{Import} thereafter click on \textbf{Agree} on the Software Licence Agreement screen. The Kali Linux virtual machine will begin installing. Wait for it to be completed. Depending on the hardware available, it will be done in a few minutes.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vbkali2.PNG}
    \caption{Software Licence Agreement screen}
\end{figure}
Once the installation is completed Oracle's VirtualBox will open to the following main screen. The newly installed Kali Linux is shown on the left of the main screen.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/vbkalimain.PNG}
    \caption{VirtualBox's main screen}
\end{figure}
Before starting up the Kali Linux virtual machine, a few settings have to be changed. Click on the \textbf{Settings} icon which is shown by a yellow gear icon. Navigate to \textbf{Systems} setting, and thereafter assign the recommended amount of \texttt{Base memory} under the \texttt{Motherboard} tab.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/settings1.PNG}
    \caption{Systems settings: Motherboard tab}
\end{figure}
Under the \texttt{Processor} tab assign the recommended amount of \texttt{Processor(s)} as well as check the \texttt{Enable Nested VT-x/AMD-V} option.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/settings2.PNG}
    \caption{Systems settings: Processor tab}
\end{figure}
If any errors are shown in the Settings for USB, then under the \texttt{USB} settings make sure that the \texttt{USB 1.1 (OHCI) Controller} option is only selected.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/settings3.PNG}
    \caption{USB settings}
\end{figure}
Click \textbf{OK} to save all your settings changes. You should now be able to start up the Kali Linux virtual machine. Click on the \texttt{Start} icon which is shown by a green arrow. Once the virtual machine starts up you will be taken to the login screen. enter the following for the username and password:
\begin{itemize}
    \item Username: \texttt{kali}
    \item Password: \texttt{kali}
\end{itemize}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/kalimain.PNG}
    \caption{Kali Linux login screen}
\end{figure}
Once you are successful in logging in, you will be greeted by the following splash screen of the Desktop.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/kalihome.PNG}
    \caption{Kali Linux's Desktop}
\end{figure}
\section{Metasploit on Kali Linux}
\subsection{Installation for the command line}
To install Metasploit on Kali Linux the following has to be done.
Go to the following GitHub url: \url{https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers}\\
Copy the following command: 
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/
templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && \
  chmod 755 msfinstall && \
  ./msfinstall
\end{minted}
Open up the terminal and paste the command copied. Thereafter press \textbf{Enter} to run it. If a password is required, Enter: \texttt{kali}\\\\
Once the package has been installed you will see the screen as shown in Figure~\ref{fig:fig11}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/meta1.PNG}
    \caption{Metasploit Framework's GitHub page}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/meta2.PNG}
    \caption{Terminal asks for root access}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/meta3.PNG}
    \caption{Terminal completed installing package}
    \label{fig:fig11}
\end{figure}
\subsection{Graphical User Interface (GUI) installation}
To install the Graphical User Interface (GUI) go to the following GitHub url:\\ \url{https://github.com/scriptjunkie/msfgui}\\\\
Thereafter run the following command in the terminal (Preferably change the directory to the Desktop beforehand):
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
cd ~/Desktop
git clone https://github.com/scriptjunkie/msfgui.git
\end{minted}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.4]{pics/meta4.PNG}
    \caption{GUI folder added to the Desktop}
\end{figure}
A directory titled \texttt{msfgui} will now to added to your Desktop. To run the GUI the following steps have to be carried out.\\
Firstly change directories to the following: \texttt{/opt/metasploit-framework/bin}. This can be done by running the command below in the terminal.
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
cd /opt/metasploit-framework/bin
\end{minted}
Thereafter run the \texttt{msfconsole} shell script. This can be done by running the command below.
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
sudo ./msfconsole
\end{minted}
If you are prompted for a root password, Enter: \texttt{kali}. Thereafter, If you are prompted with the following: \textit{"Would you like to use and setup a new database (recommended)?"}, Type \textbf{n} or \textbf{no} and press \textbf{Enter}.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/startm1.PNG}
    \caption{Type 'n' for No}
\end{figure}
Thereafter once ever thing is completed you should see that the terminal now has changed its prompt to the following.
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
msf6 > _
\end{minted}
This is shown in the picture below. This means that the Metasploit Framework has started up its service in the terminal. With this being done we can now move on to the next step of running the Graphical User Interface (GUI). Firstly you will have to open up a new terminal and change directories to the Desktop. So we can access the directory that was recently created i.e. \texttt{msfgui}. The commands are shown after Figure~\ref{fig:fig12}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/startm2.PNG}
    \caption{Type 'n' for No}
    \label{fig:fig12}
\end{figure}
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
cd ~/Desktop/msfgui
\end{minted}
Thereafter run the \texttt{msfgui} shell script. This can be done by running the command below.
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
./msfgui
\end{minted}
Make sure the other terminal that is running the Metasploit command line is also running when the above mentioned command is run. If you are shown the prompt below. Click on \textbf{Yes}.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.4]{pics/prompt1.PNG}
\end{figure}
Thereafter another window will pop up. Let it automatically make a choice. If it does not close, then click on the option \texttt{Start new msfrpcd} as shown in the figure below.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.4]{pics/prompt2.PNG}
\end{figure}
The Metasploit Framework Grahphical User Interface (GUI) will now be up and running. This is shown in the figure below.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/metaguimain.PNG}
    \caption{The main screen for the Metasploit Framework GUI}
\end{figure}
\section{Android Emulator installation}
For the first scenario covered in Section~\ref{sec:sec1} we will utilise an Emulator to virtualise an Android phone. This is keeping in line with the topic of virtualisation mentioned in Section~\ref{sec:sec2}. To emulate such a device you will need the Android Software Development Kit (SDK). This can be downloaded from the following url: \url{https://developer.android.com/studio}. Below is a screenshot of this page.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/as1.PNG}
    \caption{Homepage of Android Studio}
\end{figure}
Therefore open up the link in the browser of Kali Linux and click on button \textbf{Download Android Studio}. Thereafter Agree to the Terms and Conditions and click on the \textbf{Download Android Studio} button once again.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/as2.PNG}
    \caption{Agree to the terms and conditions}
\end{figure}
After the file has been downloaded you will see it is a \texttt{tar.gz} file. You can extract it to the Desktop either using the command line or the File Explorer. Below both options are shown. Run the following command in a terminal where the file was downloaded.
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
tar -xf filename.tar.gz -C /home/kali/Desktop
\end{minted}
The figure below shows a folder named \texttt{android-studio} created on the Desktop.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{pics/as3.PNG}
    \caption{File extracted with the File Explorer}
\end{figure}
We can now start up Android Studio and thereafter create an Android phone emulator. You will have to run the \texttt{studio} shell script inside the Android Studio folder. This can be done by running the commands below.
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
cd ~/Desktop/android-studio
\end{minted}
Thereafter,
\begin{minted}
[
frame=lines,
framesep=2mm,
baselinestretch=1.2,
bgcolor=LightBlue,
fontsize=\footnotesize,
breaklines,
breaksymbolleft=\carriagereturn
]
{Shell}
./studio
\end{minted}
\chapter{Scenario 1: Android exploit}
\label{sec:sec1}
\chapter{Scenario 2: Windows exploit}
\chapter{Additional readings and miscellaneous information}
\url{https://citizenlab.ca/}
\printbibliography[heading=bibintoc]
\end{document}